<html>
  <head>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
   <script type="text/javascript">
      google.charts.load('current', {'packages':['gauge']});
      google.charts.setOnLoadCallback(drawChart);
	  // ThingSpeak variables
      var channel_id = 2344475;
      var api_key = 'WK1HKJMH6AFPC2F2';
      var max_gauge_value = 50;
      // global variables
      var data;  
	   
      function drawChart() {

 data = google.visualization.arrayToDataTable([
          data.addColumn('string', 'Label');
		data.addColumn('number', 'Value');
		data.addRows([
		['Exterieur', 0], // Valeur initiale à 0 ou à un autre nombre par défaut
		['Interieur', 0],
		['Insufl.', 0],
		['Extract.', 0]
        ]);

        var options = {
          width: 800, height: 240,
          redFrom: 35, redTo: 50,
          yellowFrom: 25, yellowTo: 35,
          minorTicks: 5,
          max: 50,
          min: -10
        };
var chart = new google.visualization.Gauge(document.getElementById('chart_div'));
        loadData();
        chart.draw(data, options);
		
        // Load new data every 15 seconds
        setInterval(loadData, 15000);
      }
    // Load the data from ThingSpeak
      function loadData() {
      $.getJSON('https://api.thingspeak.com/channels/' + channel_id + '/feed/last.json?api_key=' + api_key, function(responseData) {
          var p1 = responseData.field1;
          var p2 = responseData.field2;
          var p3 = responseData.field3;
          var p4 = responseData.field4;
          if (p1) {
            p1 = Math.round((p1 / max_gauge_value) * 100);
            displayData('Exterieur', p1);
        }
        if (p2) {
            p2 = Math.round((p2 / max_gauge_value) * 100);
            displayData('Interieur', p2);
        }
        if (p3) {
            p3 = Math.round((p3 / max_gauge_value) * 100);
            displayData('Insufl.', p3);
        }
        if (p4) {
            p4 = Math.round((p4 / max_gauge_value) * 100);
            displayData('Extract.', p4);
          }
        });
      }
	function displayData(label, point) {
    // Find the row index based on the label
    var rowIndex;
    switch(label) {
        case 'Exterieur':
            rowIndex = 0;
            break;
        case 'Interieur':
            rowIndex = 1;
            break;
        case 'Insufl.':
            rowIndex = 2;
            break;
        case 'Extract.':
            rowIndex = 3;
            break;
        default:
            // Handle unexpected labels
            return;
    }
    // Update the value for the corresponding row
    data.setValue(rowIndex, 1, point);
		// Redessiner le graphique pour refléter les changements
    var chart = new google.visualization.Gauge(document.getElementById('chart_div'));
    chart.draw(data, options);
   }
    </script>
  </head>
  <body>
    <div id="chart_div" style="width: 400px; height: 120px;"></div>
  </body>
</html>
